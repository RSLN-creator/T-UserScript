// ==UserScript==
// @name        EHentai/EXH Modern UI 1.0.0
// @namespace   https://ehx-modern-ui-1.0.0
// @version     1.0.0
// @description æä¾›å¡ç‰‡åŠ¨ç”»ç½‘æ ¼ä½“éªŒï¼Œè“ç™½è‰²è°ƒç•Œé¢ï¼Œå·¦ä¾§æ ‡ç­¾æ å¯éšè—ï¼Œæ”¯æŒä¸­ã€æ—¥ã€è‹±èœå•ç¿»è¯‘ï¼Œå¢å¼ºçš„é˜…è¯»æ¨¡å¼ä¸è‡ªé€‚åº”å¸ƒå±€
// @author      RSYHN
// @match       https://e-hentai.org/*
// @match       https://exhentai.org/*
// @run-at      document-end
// @grant       GM_addStyle
// @grant       GM_setValue
// @grant       GM_getValue
// @grant       GM_registerMenuCommand
// ==/UserScript==

(function () {
  'use strict';

  // ---------- GM_get/set è¾…åŠ©å‡½æ•° ----------
  const GMget = (k, d) => (typeof GM_getValue === 'function' ? GM_getValue(k, d) : d);
  const GMset = (k, v) => (typeof GM_setValue === 'function' ? GM_setValue(k, v) : null);

  // ---------- ç½‘æ ¼è‡ªå®šä¹‰æ ‡è®°é€»è¾‘ ----------
  const GRID_CUSTOM_FLAG = 'ehx_grid_custom_set';
  const hasGridCustom = !!GMget(GRID_CUSTOM_FLAG, false);

  // ---------- æŒä¹…åŒ–çŠ¶æ€ ----------
  const st = {
    imgFit: GMget('ehx_imgFit', true),
    gridCols: hasGridCustom ? GMget('ehx_gridCols', 5) : 5,
    gridRows: hasGridCustom ? GMget('ehx_gridRows', 0) : 0,
    lang: GMget('ehx_lang', 'auto'),
    fontSize: GMget('ehx_fontSize', 14),
    sidebarCollapsed: GMget('ehx_sidebarCollapsed', false),
    readingMode: GMget('ehx_readingMode', 'vertical'),
  };
  const save = (k, v) => { GMset('ehx_' + k, v); st[k] = v; applyRuntimeToggles(); };

  // ---------- å°å·¥å…·å‡½æ•° ----------
  function clampInt(v, lo, hi){ v = parseInt(v||0,10); if(isNaN(v)) v=lo; return Math.max(lo, Math.min(hi, v)); }
  function escapeHtml(s){ return (s||'').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }
  function isVisible(el){
    if(!el) return false;
    if(el.offsetParent === null) return false;
    const r = el.getBoundingClientRect();
    return !!(r.width && r.height);
  }

  // ---------- ç¿»è¯‘æ–‡æœ¬é›†åˆ ----------
  const langTexts = {
    en: {
      'EHX Modern UI': 'EHX Modern UI',
      'Language': 'Language',
      'Auto (Browser)': 'Auto (Browser)',
      'Note: This is for UI language.': 'Note: This is for UI language.',
      'Settings': 'Settings',
      'Fit image to page width': 'Fit image to page width',
      'Font Size': 'Font Size',
      'Tips': 'Tips',
      'Cols': 'Cols',
      'Rows (0=auto)': 'Rows (0=auto)',
      'Apply Grid': 'Apply Grid',
      'Favorite (Not Functional)': 'Favorite (Not Functional)',
      'Left nav, grid settings are on gallery page, gallery lists are card grids.': 'Left nav, grid settings are on gallery page, gallery lists are card grids.',
      'Next': 'Next',
      'Last': 'Last',
      'Jump/Seek': 'Jump/Seek',
      'Previous': 'Previous',
      'First': 'First',
      'Front Page': 'Front Page',
      'Watched': 'Watched',
      'Popular': 'Popular',
      'Torrents': 'Torrents',
      'Favorites': 'Favorites',
      'My Home': 'My Home',
      'My Uploads': 'My Uploads',
      'Toplists': 'Toplists',
      'Bounties': 'Bounties',
      'News': 'News',
      'Forums': 'Forums',
      'Wiki': 'Wiki',
      'HentaiVerse': 'HentaiVerse',
      'Reading Mode': 'Reading Mode',
      'Vertical': 'Vertical',
      'Horizontal': 'Horizontal',
      'Keyboard Shortcuts': 'Keyboard Shortcuts',
      'â†’/â†: Scroll page': 'â†’/â†: Scroll page',
      'W/S: Scroll up/down': 'W/S: Scroll up/down',
      'Click image: Fullscreen': 'Click image: Fullscreen'
    },
    zh: {
      'EHX Modern UI': 'EHX ç°ä»£ UI',
      'Language': 'è¯­è¨€',
      'Auto (Browser)': 'è‡ªåŠ¨ (æµè§ˆå™¨)',
      'Note: This is for UI language.': 'æ³¨ï¼šæ­¤å¤„ä¸º UI è¯­è¨€ã€‚',
      'Settings': 'è®¾ç½®',
      'Fit image to page width': 'å›¾ç‰‡è‡ªé€‚åº”é¡µé¢å®½åº¦',
      'Font Size': 'å­—ä½“å¤§å°',
      'Tips': 'æç¤º',
      'Cols': 'åˆ—æ•°',
      'Rows (0=auto)': 'è¡Œæ•° (0=è‡ªåŠ¨)',
      'Apply Grid': 'åº”ç”¨ç½‘æ ¼',
      'Favorite (Not Functional)': 'æ”¶è—ï¼ˆæš‚ä¸å¯ç”¨ï¼‰',
      'Left nav, grid settings are on gallery page, gallery lists are card grids.': 'å¯¼èˆªå·²å·¦ç§»ï¼Œç½‘æ ¼è®¾ç½®åœ¨ç”»å»Šé¡¶éƒ¨ã€‚ç”»å»Šåˆ—è¡¨å·²ä¼˜åŒ–ä¸ºå¡ç‰‡ç½‘æ ¼ã€‚',
      'Next': 'ä¸‹ä¸€é¡µ',
      'Last': 'æœ€åä¸€é¡µ',
      'Jump/Seek': 'è·³è½¬',
      'Previous': 'ä¸Šä¸€é¡µ',
      'First': 'ç¬¬ä¸€é¡µ',
      'Front Page': 'é¦–é¡µ',
      'Watched': 'å·²å…³æ³¨',
      'Popular': 'çƒ­é—¨',
      'Torrents': 'ç§å­',
      'Favorites': 'æ”¶è—',
      'My Home': 'æˆ‘çš„ä¸»é¡µ',
      'My Uploads': 'æˆ‘çš„ä¸Šä¼ ',
      'Toplists': 'æ’è¡Œæ¦œ',
      'Bounties': 'æ‚¬èµ',
      'News': 'æ–°é—»',
      'Forums': 'è®ºå›',
      'Wiki': 'ç»´åŸº',
      'HentaiVerse': 'HentaiVerse',
      'Reading Mode': 'é˜…è¯»æ¨¡å¼',
      'Vertical': 'å‚ç›´',
      'Horizontal': 'æ°´å¹³',
      'Keyboard Shortcuts': 'é”®ç›˜å¿«æ·é”®',
      'â†’/â†: Scroll page': 'â†’/â†: ç¿»é¡µæ»šåŠ¨',
      'W/S: Scroll up/down': 'W/S: ä¸Šä¸‹æ»šåŠ¨',
      'Click image: Fullscreen': 'ç‚¹å‡»å›¾ç‰‡: å…¨å±'
    },
    ja: {
      'EHX Modern UI': 'EHX ãƒ¢ãƒ€ãƒ³UI',
      'Language': 'è¨€èª',
      'Auto (Browser)': 'è‡ªå‹•ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ï¼‰',
      'Note: This is for UI language.': 'æ³¨: ã“ã‚Œã¯UIè¨€èªã§ã™ã€‚',
      'Settings': 'è¨­å®š',
      'Fit image to page width': 'ç”»åƒå¹…ã‚’ãƒšãƒ¼ã‚¸ã«åˆã‚ã›ã‚‹',
      'Font Size': 'ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚º',
      'Tips': 'ãƒ’ãƒ³ãƒˆ',
      'Cols': 'åˆ—æ•°',
      'Rows (0=auto)': 'è¡Œæ•°ï¼ˆ0=è‡ªå‹•ï¼‰',
      'Apply Grid': 'é©ç”¨',
      'Favorite (Not Functional)': 'ãŠæ°—ã«å…¥ã‚Šï¼ˆæœªå®Ÿè£…ï¼‰',
      'Left nav, grid settings are on gallery page, gallery lists are card grids.': 'å·¦ãƒŠãƒ“ã€ã‚°ãƒªãƒƒãƒ‰è¨­å®šã¯ã‚®ãƒ£ãƒ©ãƒªãƒ¼ãƒšãƒ¼ã‚¸ã«ã‚ã‚Šã¾ã™ã€‚ãƒªã‚¹ãƒˆã¯ã‚«ãƒ¼ãƒ‰ã‚°ãƒªãƒƒãƒ‰ã«æœ€é©åŒ–ã•ã‚Œã¦ã„ã¾ã™ã€‚',
      'Next': 'æ¬¡ã¸',
      'Last': 'æœ€å¾Œ',
      'Jump/Seek': 'ã‚¸ãƒ£ãƒ³ãƒ—',
      'Previous': 'å‰ã¸',
      'First': 'æœ€åˆ',
      'Front Page': 'ãƒ•ãƒ­ãƒ³ãƒˆãƒšãƒ¼ã‚¸',
      'Watched': 'ã‚¦ã‚©ãƒƒãƒ',
      'Popular': 'äººæ°—',
      'Torrents': 'ãƒˆãƒ¬ãƒ³ãƒˆ',
      'Favorites': 'ãŠæ°—ã«å…¥ã‚Š',
      'My Home': 'ãƒã‚¤ãƒ›ãƒ¼ãƒ ',
      'My Uploads': 'ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰',
      'Toplists': 'ãƒˆãƒƒãƒ—ãƒªã‚¹ãƒˆ',
      'Bounties': 'ãƒã‚¦ãƒ³ãƒ†ã‚£',
      'News': 'ãƒ‹ãƒ¥ãƒ¼ã‚¹',
      'Forums': 'ãƒ•ã‚©ãƒ¼ãƒ©ãƒ ',
      'Wiki': 'ã‚¦ã‚£ã‚­',
      'HentaiVerse': 'HentaiVerse',
      'Reading Mode': 'é–²è¦§ãƒ¢ãƒ¼ãƒ‰',
      'Vertical': 'å‚ç›´',
      'Horizontal': 'æ°´å¹³',
      'Keyboard Shortcuts': 'ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ',
      'â†’/â†: Scroll page': 'â†’/â†: ãƒšãƒ¼ã‚¸ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«',
      'W/S: Scroll up/down': 'W/S: ä¸Šä¸‹ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«',
      'Click image: Fullscreen': 'ç”»åƒã‚¯ãƒªãƒƒã‚¯: å…¨ç”»é¢'
    }
  };
  const getTranslatedText = (k, lang) => {
    lang = lang || (st.lang === 'auto' ? (navigator.language || 'en').slice(0, 2) : st.lang);
    return (langTexts[lang] && langTexts[lang][k]) || (langTexts['en'][k]) || k;
  };

  // ---------- æ ·å¼å®šä¹‰ ----------
  GM_addStyle(`
    :root{
      --ehx-bg:#f8f9fb; --ehx-panel:#fff; --ehx-accent:#0096ff; --ehx-subtext:#707070; --ehx-border:#e6e8eb;
      --ehx-radius:12px; --ehx-shadow:0 8px 24px rgba(0,0,0,0.04); --ehx-sidebar-w:240px; --ehx-gap:20px; --ehx-font-size:${st.fontSize}px;
      --ehx-content-max:1200px;
    }
    body.ehx-on { background:var(--ehx-bg) !important; color:#222 !important; font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial; }
    body.ehx-on, body.ehx-on * { font-size: var(--ehx-font-size); }

    .ehx-shell { display:grid; grid-template-columns: var(--ehx-sidebar-w) 1fr; gap: var(--ehx-gap); min-height:100vh; transition: grid-template-columns .28s ease; }
    .ehx-sidebar { position:sticky; top:0; height:100vh; overflow:auto; background:var(--ehx-panel); border-right:1px solid var(--ehx-border); padding:16px; box-sizing:border-box; display:flex; flex-direction:column; z-index:9999; transition:opacity .2s ease, transform .28s ease, width .28s ease; }
    /* ä¾§è¾¹æ æŠ˜å æ ·å¼ */
    body.ehx-sidebar-collapsed .ehx-shell { grid-template-columns: 0 1fr; }
    body.ehx-sidebar-collapsed .ehx-sidebar { width:0 !important; opacity:0; pointer-events:none; }
    body.ehx-sidebar-collapsed .ehx-main { width: min(var(--ehx-content-max), calc(100% - 2*var(--ehx-gap))); margin-left:auto; margin-right:auto; }

    .ehx-brand {
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 700;
      color: var(--ehx-accent);
      margin-bottom: 8px;
    }
    .ehx-brand #ehx-collapse-btn{margin-left:auto;border:0;background:transparent;cursor:pointer;font-size:18px;}
    .ehx-nav{margin-top:6px;display:flex;flex-direction:column;gap:6px;flex-grow:1;}
    .ehx-nav a{padding:10px 12px;border-radius:10px;display:flex;gap:10px;align-items:center;text-decoration:none;color:inherit;}
    .ehx-nav a:hover{background:rgba(0,150,255,0.06);}

    /* é‡å¤é¡¹éšè—æ ·å¼ */
    .ehx-duplicate-hidden {
        display: none !important;
    }

    .ehx-main{padding:20px;box-sizing:border-box;max-width:calc(100vw - var(--ehx-sidebar-w) - 2*var(--ehx-gap)); width:calc(100vw - var(--ehx-sidebar-w) - 2*var(--ehx-gap)); transition:margin .28s ease, width .28s ease;}

    /* å¡ç‰‡ç½‘æ ¼æ ·å¼ */
    .ehx-grid{display:grid;gap:20px;grid-auto-rows:1fr;}
    .ehx-cell{background:var(--ehx-panel);border-radius:var(--ehx-radius);overflow:hidden;box-shadow:var(--ehx-shadow);display:flex;flex-direction:column;text-decoration:none;color:inherit;position:relative;transition:transform .18s ease,box-shadow .18s ease;}
    .ehx-cell:hover{transform:translateY(-6px);box-shadow:0 14px 40px rgba(0,0,0,0.12);}
    .ehx-thumb{position:relative;width:100%;height:0;padding-bottom:141.42%;background:#f0f0f0;overflow:hidden;}
    .ehx-thumb img{position:absolute;left:0;top:0;width:100%;height:100%;object-fit:cover;display:block;}
    .ehx-meta{padding:12px;display:flex;flex-direction:column;gap:8px;color:var(--ehx-subtext);min-height:64px;}
    .ehx-title{font-weight:600;color:#1e293b;font-size:15px;line-height:1.2;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis;}
    .ehx-info{font-size:12px;color:var(--ehx-subtext);max-height:1.6em;overflow:hidden;transition:max-height .22s ease,opacity .22s ease;white-space:nowrap;text-overflow:ellipsis;}
    .ehx-cell:hover .ehx-info{max-height:6em;white-space:normal;overflow:auto;}
    .ehx-favorite-btn{position:absolute;top:10px;right:10px;width:36px;height:36px;border-radius:50%;background:rgba(255,255,255,0.85);display:flex;align-items:center;justify-content:center;box-shadow:0 4px 12px rgba(0,0,0,0.06);border:1px solid var(--ehx-border);cursor:pointer;}
    .ehx-favorite-btn:hover{background:rgba(255,255,255,1);transform:scale(1.03);}

    /* å·¥å…·æ å’Œåˆ†é¡µæ ·å¼ */
    .ehx-grid-toolbar{display:flex;justify-content:flex-end;gap:10px;margin-bottom:16px;align-items:center;}
    .ptt td a{background:var(--ehx-panel);border:1px solid var(--ehx-border);border-radius:8px;padding:6px 10px;color:inherit;}

    /* ç¡®ä¿æœç´¢å…ƒç´ å¯è§ */
    form[action*="search"], #searchform, .gsearch, .srch, #taglist { visibility:visible !important; opacity:1 !important; display:block !important; }

    /* ä¾§è¾¹æ æŠ˜å æ—¶çš„æ˜¾ç¤ºæŒ‰é’® */
    .ehx-show-sidebar-btn{position:fixed;left:8px;top:8px;z-index:11000;width:40px;height:40px;border-radius:8px;display:none;align-items:center;justify-content:center;background:#fff;border:1px solid var(--ehx-border);box-shadow:0 6px 18px rgba(0,0,0,0.08);cursor:pointer;}
    body.ehx-sidebar-collapsed .ehx-show-sidebar-btn{display:flex;}

    .ehx-select {
      background-color: #fff;
      color: #000;
      padding: 4px 8px;
      border-radius: 6px;
      border: 1px solid var(--ehx-border);
      margin: 4px 0;
    }

    .ehx-section {
      margin: 16px 0;
      padding: 8px 0;
      border-top: 1px solid var(--ehx-border);
    }

    .ehx-label {
      font-weight: 600;
      margin-bottom: 8px;
      color: #333;
    }

    .ehx-control {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .ehx-row {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .ehx-number, .ehx-range {
      padding: 4px 8px;
      border-radius: 6px;
      border: 1px solid var(--ehx-border);
      width: 60px;
    }

    .ehx-range {
      width: 120px;
    }

    .ehx-btn {
      background: var(--ehx-accent);
      color: white;
      border: none;
      border-radius: 6px;
      padding: 6px 12px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .ehx-btn:hover {
      background: #007bcc;
    }

    /* é˜…è¯»æ¨¡å¼å¢å¼ºæ ·å¼ */
    #i3 {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
      padding: 20px 0;
    }

    #i3 img {
      max-width: 95vw !important;
      height: auto !important;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      transition: transform 0.2s;
    }

    #i3 img:hover {
      transform: scale(1.01);
    }

    /* é˜…è¯»æ¨¡å¼ä¸ºæ°´å¹³æ—¶çš„æ ·å¼ */
    body.ehx-reading-horizontal #i3 {
      flex-direction: row;
      flex-wrap: nowrap;
      overflow-x: auto;
      padding: 20px;
      height: calc(100vh - 40px);
      align-items: center;
    }

    body.ehx-reading-horizontal #i3 img {
      max-height: 90vh !important;
      max-width: auto !important;
    }

    /* å…¨å±å›¾ç‰‡æ ·å¼ */
    #i3 img:fullscreen {
      max-width: 100vw !important;
      max-height: 100vh !important;
      object-fit: contain;
      background: #000;
    }
  `);

  // ---------- å¯¼èˆªé‡å¤é¡¹æ£€æŸ¥ä¸ä¿®å¤ ----------
  function checkAndRemoveNavDuplicates() {
    // éœ€è¦æ£€æŸ¥é‡å¤çš„å¯¼èˆªé¡¹æ–‡æœ¬ï¼ˆè‹±æ–‡åŸç‰ˆï¼‰
    const targetNavItems = [
        'Front Page',
        'Watched',
        'Popular',
        'Torrents',
        'Favorites',
        'My Home',
        'My Uploads',
        'Toplists',
        'Bounties',
        'News',
        'Forums',
        'Wiki',
        'HentaiVerse'
    ];

    // è·å–å¯¼èˆªå®¹å™¨
    const navContainer = document.querySelector('.ehx-nav');
    if (!navContainer) {
        console.log('EHXå¯¼èˆªå®¹å™¨æœªæ‰¾åˆ°');
        return;
    }

    // å­˜å‚¨å·²å‘ç°çš„å¯¼èˆªé¡¹
    const foundItems = {};
    targetNavItems.forEach(item => {
        foundItems[item] = [];
    });

    // è·å–æ‰€æœ‰å¯¼èˆªé“¾æ¥
    const navLinks = navContainer.querySelectorAll('a');
    if (navLinks.length === 0) {
        console.log('æœªæ‰¾åˆ°å¯¼èˆªé“¾æ¥');
        return;
    }

    // éå†æ‰€æœ‰é“¾æ¥ï¼Œæ‰¾åˆ°ç›®æ ‡å¯¼èˆªé¡¹
    navLinks.forEach(link => {
        // è·å–é“¾æ¥æ–‡æœ¬ï¼ˆå»é‡å¤„ç†ï¼‰
        const linkText = link.textContent.trim();

        // æ£€æŸ¥é“¾æ¥æ–‡æœ¬æ˜¯å¦åŒ¹é…ç›®æ ‡é¡¹ï¼ˆè€ƒè™‘å¯èƒ½çš„ç¿»è¯‘ï¼‰
        for (const target of targetNavItems) {
            // å°è¯•é€šè¿‡åŸå§‹æ–‡æœ¬æŸ¥æ‰¾
            if (linkText === target) {
                foundItems[target].push(link);
                break;
            }

            // å°è¯•é€šè¿‡ç¿»è¯‘æ˜ å°„æŸ¥æ‰¾
            const translations = {
                'Front Page': ['é¦–é¡µ', 'ãƒ•ãƒ­ãƒ³ãƒˆãƒšãƒ¼ã‚¸'],
                'Watched': ['å·²å…³æ³¨', 'ã‚¦ã‚©ãƒƒãƒ'],
                'Popular': ['çƒ­é—¨', 'äººæ°—'],
                'Torrents': ['ç§å­', 'ãƒˆãƒ¬ãƒ³ãƒˆ'],
                'Favorites': ['æ”¶è—', 'ãŠæ°—ã«å…¥ã‚Š'],
                'My Home': ['æˆ‘çš„ä¸»é¡µ', 'ãƒã‚¤ãƒ›ãƒ¼ãƒ '],
                'My Uploads': ['æˆ‘çš„ä¸Šä¼ ', 'ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰'],
                'Toplists': ['æ’è¡Œæ¦œ', 'ãƒˆãƒƒãƒ—ãƒªã‚¹ãƒˆ'],
                'Bounties': ['æ‚¬èµ', 'ãƒã‚¦ãƒ³ãƒ†ã‚£'],
                'News': ['æ–°é—»', 'ãƒ‹ãƒ¥ãƒ¼ã‚¹'],
                'Forums': ['è®ºå›', 'ãƒ•ã‚©ãƒ¼ãƒ©ãƒ '],
                'Wiki': ['ç»´åŸº', 'ã‚¦ã‚£ã‚­'],
                'HentaiVerse': ['HentaiVerse', 'HentaiVerse']
            };

            if (translations[target] && translations[target].includes(linkText)) {
                foundItems[target].push(link);
                break;
            }
        }
    });

    // æ£€æŸ¥å¹¶éšè—é‡å¤é¡¹ï¼ˆä¿ç•™ç¬¬ä¸€ä¸ªå‡ºç°çš„ï¼Œéšè—åç»­çš„ï¼‰
    let duplicatesFound = false;
    for (const key in foundItems) {
        const items = foundItems[key];
        if (items.length > 1) {
            duplicatesFound = true;
            // ä¿ç•™ç¬¬ä¸€ä¸ªï¼Œéšè—å…¶ä½™çš„
            for (let i = 1; i < items.length; i++) {
                items[i].classList.add('ehx-duplicate-hidden');
                console.log(`å·²éšè—é‡å¤çš„å¯¼èˆªé¡¹: ${key}`);
            }
        }
    }

    if (duplicatesFound) {
        console.log('å¯¼èˆªé‡å¤é¡¹æ£€æŸ¥å®Œæˆï¼Œå·²å¤„ç†æ‰€æœ‰é‡å¤é¡¹');
    } else {
        console.log('æœªå‘ç°å¯¼èˆªé‡å¤é¡¹');
    }
  }

  // ---------- æ„å»ºå¤–å£³ï¼ˆä¾§è¾¹æ  + ä¸»å†…å®¹åŒºï¼‰ ----------
  function wrapSite(){
    if(document.body.classList.contains('ehx-on')) return;
    document.body.classList.add('ehx-on');

    const shell = document.createElement('div'); shell.className = 'ehx-shell';
    const sidebar = document.createElement('aside'); sidebar.className = 'ehx-sidebar';
    const main = document.createElement('main'); main.className = 'ehx-main';

    // å¡«å……ä¾§è¾¹æ HTMLï¼ˆæ§ä»¶ + å“ç‰Œï¼‰
    sidebar.innerHTML = `
      <div class="ehx-brand">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M7 2a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2Z"/><path d="M10 16v1.5a2.5 2.5 0 0 0 5 0V16"/></svg>
        <span id="ehx-brand-text">${getTranslatedText('EHX Modern UI')}</span>
        <button id="ehx-collapse-btn" title="Toggle sidebar">â˜°</button>
      </div>
      <nav class="ehx-nav" id="ehx-nav"></nav>

      <div class="ehx-section">
        <div class="ehx-label">${getTranslatedText('Language')}</div>
        <div class="ehx-control">
          <select id="ehx-lang" class="ehx-select">
            <option value="auto">${getTranslatedText('Auto (Browser)')}</option>
            <option value="en">English</option>
            <option value="zh">ä¸­æ–‡</option>
            <option value="ja">æ—¥æœ¬èª</option>
          </select>
          <div class="ehx-row" style="font-size:12px;color:var(--ehx-subtext);"><span>${getTranslatedText('Note: This is for UI language.')}</span></div>
        </div>
      </div>

      <div class="ehx-section">
        <div class="ehx-label">âš™ï¸ ${getTranslatedText('Settings')}</div>
        <div class="ehx-control">
          <label class="ehx-row"><input id="ehx-fit" type="checkbox" class="ehx-switch"/> ${getTranslatedText('Fit image to page width')}</label>
          <div class="ehx-row">
            <span>${getTranslatedText('Font Size')}:</span>
            <input id="ehx-font-size-range" type="range" min="12" max="20" step="1" class="ehx-range"/>
            <span id="ehx-font-size-val">${st.fontSize}px</span>
          </div>
          <div class="ehx-row">
            <span>${getTranslatedText('Reading Mode')}:</span>
            <select id="ehx-reading-mode" class="ehx-select">
              <option value="vertical">${getTranslatedText('Vertical')}</option>
              <option value="horizontal">${getTranslatedText('Horizontal')}</option>
            </select>
          </div>
        </div>
      </div>

      <div class="ehx-section">
        <div class="ehx-label">âŒ¨ï¸ ${getTranslatedText('Keyboard Shortcuts')}</div>
        <div class="ehx-control" style="font-size:12px;color:var(--ehx-subtext);">
          <div>â€¢ ${getTranslatedText('â†’/â†: Scroll page')}</div>
          <div>â€¢ ${getTranslatedText('W/S: Scroll up/down')}</div>
          <div>â€¢ ${getTranslatedText('Click image: Fullscreen')}</div>
        </div>
      </div>

      <div class="ehx-section">
        <div class="ehx-label">ğŸ’¡ ${getTranslatedText('Tips')}</div>
        <div class="ehx-control" style="font-size:12px;color:var(--ehx-subtext);">
          <div>â€¢ ${getTranslatedText('Left nav, grid settings are on gallery page, gallery lists are card grids.')}</div>
        </div>
      </div>
    `;

    // å°†åŸå§‹bodyå­å…ƒç´ ç§»åŠ¨åˆ°mainä¸­ï¼ˆä¿ç•™å†…å®¹ï¼‰
    while(document.body.firstChild){
      const n = document.body.firstChild;
      if(n === shell) break;
      main.appendChild(n);
    }

    shell.appendChild(sidebar);
    shell.appendChild(main);
    document.body.appendChild(shell);

    // æ˜¾ç¤ºä¾§è¾¹æ æŒ‰é’®ï¼ˆä»…åœ¨æŠ˜å æ—¶å¯è§ï¼‰
    const showBtn = document.createElement('button');
    showBtn.className = 'ehx-show-sidebar-btn';
    showBtn.title = 'Show sidebar';
    showBtn.innerHTML = 'â˜°';
    showBtn.addEventListener('click', () => toggleSidebar(false));
    document.body.appendChild(showBtn);

    // æ„å»ºå·¦ä¾§å¯¼èˆªï¼ˆå®Œå…¨ä½¿ç”¨557ç‰ˆæœ¬é€»è¾‘ï¼‰
    buildLeftNav(sidebar);

    // åœ¨å¯¼èˆªæ„å»ºå®Œæˆåæ£€æŸ¥å¹¶ç§»é™¤é‡å¤é¡¹
    checkAndRemoveNavDuplicates();

    // åˆå§‹åŒ–æ§ä»¶
    initControls(sidebar);

    // æ£€æŸ¥æ˜¯å¦ä¸ºé˜…è¯»é¡µé¢å¹¶åº”ç”¨å¢å¼ºåŠŸèƒ½
    if (window.location.pathname.includes('/s/')) {
      initReaderEnhancements();
    } else {
      // ç½‘æ ¼åŒ–ç”»å»Š/åˆ—è¡¨é¡µé¢
      const urlParams = new URLSearchParams(window.location.search);
      const fSearchParam = urlParams.get('f_search');
      const isMinimalMode = fSearchParam === 'fminimal' || fSearchParam === 'fminimalplus' || fSearchParam === 'fcompact';

      if (!isMinimalMode) {
        tryGridify(main);
      }
    }

    // æ¢å¤æœç´¢UI
    restoreSearchUI(main);

    // åº”ç”¨åˆ‡æ¢
    applyRuntimeToggles();
  }

  // ---------- æ„å»ºå·¦ä¾§å¯¼èˆªï¼ˆå®Œå…¨ç…§æŠ„557ç‰ˆæœ¬å®ç°ï¼‰ ----------
  function buildLeftNav(sidebar) {
    const nav = sidebar.querySelector('#ehx-nav');
    nav.innerHTML = '';

    // 557ç‰ˆæœ¬å»é‡é€»è¾‘ï¼šä½¿ç”¨é“¾æ¥ä½œä¸ºå”¯ä¸€æ ‡è¯†
    const addedLinks = new Set();

    // æå–é¡µé¢ç°æœ‰å¯¼èˆªé“¾æ¥
    const navContainers = [
      document.querySelector('#nb'),
      document.querySelector('.ptt'),
      document.querySelector('.ido'),
      document.querySelector('table.ptt'),
      document.body
    ];

    let pageLinks = [];
    for (const container of navContainers) {
      if (!container) continue;
      const links = Array.from(container.querySelectorAll('a[href]'))
        .filter(a => {
          const href = a.getAttribute('href');
          const text = (a.textContent || '').trim();
          return href && text && href.length > 0 && text.length > 0;
        });

      if (links.length > 0) {
        pageLinks = links;
        break;
      }
    }

    // æ·»åŠ é¡µé¢é“¾æ¥ï¼ˆå»é‡ï¼‰
    pageLinks.forEach(link => {
      const href = link.href;
      const text = link.textContent.trim();

      if (addedLinks.has(href) || !href || !text) return;

      addedLinks.add(href);
      const navLink = document.createElement('a');
      navLink.href = href;
      navLink.textContent = getTranslatedText(text); // ä¿ç•™ç¿»è¯‘
      nav.appendChild(navLink);
    });

    // 557ç‰ˆæœ¬å›ºå®šå¯¼èˆªé¡¹ï¼ˆæŒ‰åŸé¡ºåºï¼‰
    const coreLinks = [
      { href: '/', text: 'Front Page' },
      { href: '/watched', text: 'Watched' },
      { href: '/popular', text: 'Popular' },
      { href: '/torrents.php', text: 'Torrents' },
      { href: '/favorites.php', text: 'Favorites' },
      { href: '/home.php', text: 'My Home' },
      { href: '/upload.php', text: 'My Uploads' },
      { href: '/toplist.php', text: 'Toplists' },
      { href: '/bounties.php', text: 'Bounties' },
      { href: '/news.php', text: 'News' },
      { href: '/forums.php', text: 'Forums' },
      { href: '/wiki.php', text: 'Wiki' },
      { href: '/hentaiverse.php', text: 'HentaiVerse' }
    ];

    // æ·»åŠ æ ¸å¿ƒå¯¼èˆªé¡¹ï¼ˆå»é‡ï¼‰
    coreLinks.forEach(item => {
      const normalizedHref = new URL(item.href, window.location.origin).href;

      if (addedLinks.has(normalizedHref)) return;

      addedLinks.add(normalizedHref);
      const navLink = document.createElement('a');
      navLink.href = item.href;
      navLink.textContent = getTranslatedText(item.text); // ä¿ç•™ç¿»è¯‘
      nav.appendChild(navLink);
    });
  }

  // ---------- åˆ‡æ¢ä¾§è¾¹æ æŠ˜å çŠ¶æ€ ----------
  function toggleSidebar(collapse){
    const should = (collapse === undefined) ? !st.sidebarCollapsed : !!collapse;
    GMset('ehx_sidebarCollapsed', should);
    st.sidebarCollapsed = should;
    document.body.classList.toggle('ehx-sidebar-collapsed', should);
  }

  // ---------- åˆå§‹åŒ–æ§ä»¶ ----------
  function initControls(sidebar){
    const langSelect = sidebar.querySelector('#ehx-lang');
    langSelect.value = st.lang;
    const fitCheckbox = sidebar.querySelector('#ehx-fit');
    fitCheckbox.checked = !!st.imgFit;
    const fontSizeRange = sidebar.querySelector('#ehx-font-size-range');
    const fontSizeVal = sidebar.querySelector('#ehx-font-size-val');
    fontSizeRange.value = st.fontSize;
    fontSizeVal.textContent = `${st.fontSize}px`;
    const readingModeSelect = sidebar.querySelector('#ehx-reading-mode');
    readingModeSelect.value = st.readingMode;

    langSelect.addEventListener('change', e => {
      GMset('ehx_lang', e.target.value);
      location.reload();
    });

    fitCheckbox.addEventListener('change', e=>{
      GMset('ehx_imgFit', !!e.target.checked);
      st.imgFit = !!e.target.checked;
      applyRuntimeToggles();
    });

    fontSizeRange.addEventListener('input', e=>{
      const s = parseInt(e.target.value, 10);
      GMset('ehx_fontSize', s);
      st.fontSize = s;
      fontSizeVal.textContent = `${s}px`;
      applyRuntimeToggles();
    });

    readingModeSelect.addEventListener('change', e => {
      const mode = e.target.value;
      GMset('ehx_readingMode', mode);
      st.readingMode = mode;
      applyReadingMode();
    });

    const collapseBtn = sidebar.querySelector('#ehx-collapse-btn');
    collapseBtn.addEventListener('click', ()=> toggleSidebar(!st.sidebarCollapsed));

    // åº”ç”¨åˆå§‹æŠ˜å çŠ¶æ€
    document.body.classList.toggle('ehx-sidebar-collapsed', !!st.sidebarCollapsed);
    // åº”ç”¨åˆå§‹é˜…è¯»æ¨¡å¼
    applyReadingMode();
  }

  // ---------- åº”ç”¨é˜…è¯»æ¨¡å¼ ----------
  function applyReadingMode() {
    document.body.classList.toggle('ehx-reading-horizontal', st.readingMode === 'horizontal');
    document.body.classList.toggle('ehx-reading-vertical', st.readingMode === 'vertical');
  }

  // ---------- è¿è¡Œæ—¶åˆ‡æ¢ ----------
  function applyLangAttr(){
    const lang = st.lang === 'auto' ? (navigator.language||'en').slice(0,2) : st.lang;
    document.documentElement.setAttribute('lang', lang);
    // åˆ†é¡µç¿»è¯‘
    document.querySelectorAll('.ptt a').forEach(link=>{
      const t = link.textContent.trim();
      if(t === 'Next >') link.textContent = getTranslatedText('Next');
      if(t === 'Last >>') link.textContent = getTranslatedText('Last');
      if(t === '< Prev') link.textContent = getTranslatedText('Previous');
      if(t === 'First <<') link.textContent = getTranslatedText('First');
      if(t === 'Jump/Seek') link.textContent = getTranslatedText('Jump/Seek');
    });
  }

  function applyFontSize(){
    document.documentElement.style.setProperty('--ehx-font-size', `${st.fontSize}px`);
  }

  function applyImageFit() {
    const images = document.querySelectorAll('#i3 img, .ehx-thumb img');
    images.forEach(img => {
      if (st.imgFit) {
        img.style.maxWidth = '95vw';
        img.style.height = 'auto';
      } else {
        img.style.maxWidth = '';
        img.style.height = '';
      }
    });
  }

  function applyRuntimeToggles(){
    applyFontSize();
    applyLangAttr();
    document.body.classList.toggle('ehx-fit', !!st.imgFit);
    applyImageFit();
  }

  // ---------- ç½‘æ ¼åŒ–åˆ—è¡¨å¸ƒå±€ ----------
  function tryGridify(main){
    const itg = main.querySelector('.itg') || main.querySelector('table.itg');
    if(!itg) return;
    main.classList.add('ehx-gridify');

    // å·¥å…·æ ï¼ˆåªæ·»åŠ ä¸€æ¬¡ï¼‰
    if(!itg.previousElementSibling || !itg.previousElementSibling.classList.contains('ehx-grid-toolbar')){
      const toolbar = document.createElement('div');
      toolbar.className = 'ehx-grid-toolbar';
      const initialCols = st.gridCols;
      const initialRows = st.gridRows;
      toolbar.innerHTML = `
        <div class="ehx-row"><span>${getTranslatedText('Cols')}:</span><input id="ehx-cols" type="number" min="2" max="12" step="1" class="ehx-number" value="${initialCols}"/></div>
        <div class="ehx-row"><span>${getTranslatedText('Rows (0=auto)')}:</span><input id="ehx-rows" type="number" min="0" max="12" step="1" class="ehx-number" value="${initialRows}"/></div>
        <button id="ehx-apply-grid" class="ehx-btn">${getTranslatedText('Apply Grid')}</button>
      `;
      itg.parentNode.insertBefore(toolbar, itg);

      // åº”ç”¨ç½‘æ ¼è¡Œä¸º
      toolbar.querySelector('#ehx-apply-grid').addEventListener('click', ()=>{
        const cols = clampInt(parseInt(toolbar.querySelector('#ehx-cols').value || 0, 10), 2, 12);
        const rows = clampInt(parseInt(toolbar.querySelector('#ehx-rows').value || 0, 10), 0, 12);
        GMset('ehx_gridCols', cols);
        GMset('ehx_gridRows', rows);
        GMset(GRID_CUSTOM_FLAG, true);
        st.gridCols = cols;
        st.gridRows = rows;
        applyGridStyles(toolbar.nextElementSibling);
      });
    }

    // æ”¶é›†é¡¹ç›®
    const rowAnchors = itg.querySelectorAll('a[href*="/g/"]');
    const seen = new Set();
    const items = [];
    rowAnchors.forEach(a=>{
      const href = a.getAttribute('href');
      if(!href || seen.has(href)) return;
      seen.add(href);
      const container = a.closest('.gl1t, .gl3t, .glthumb, td') || a;
      const img = container ? container.querySelector('img') : null;
      const title = a.title || (img && img.alt) || (container && container.textContent.trim()) || a.textContent.trim();
      const infoEl = container && (container.querySelector('.gld') || container.querySelector('.gtb') || container.querySelector('.gt') || container.querySelector('.gtl') || container.querySelector('.gtd'));
      const info = infoEl ? infoEl.textContent.trim() : '';
      items.push({href, thumbSrc: img ? (img.getAttribute('data-src') || img.src) : '', title, info});
    });

    if(!items.length) return;

    const grid = document.createElement('div'); grid.className = 'ehx-grid';
    items.forEach(it=>{
      const cell = document.createElement('a'); cell.className = 'ehx-cell'; cell.href = it.href;
      cell.innerHTML = `
        <div class="ehx-thumb">${it.thumbSrc ? `<img loading="lazy" referrerpolicy="no-referrer" src="${it.thumbSrc}" alt="${escapeHtml(it.title)}">` : ''}</div>
        <div class="ehx-meta">
          <div class="ehx-title">${escapeHtml(it.title||'')}</div>
          <div class="ehx-info">${escapeHtml(it.info||'')}</div>
        </div>
        <div class="ehx-favorite-btn" title="${getTranslatedText('Favorite (Not Functional)')}">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.76-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg>
        </div>
      `;
      grid.appendChild(cell);
    });

    itg.replaceWith(grid);
    applyGridStyles(grid);

    // æ·»åŠ ç”»å»Šæ ‡é¢˜
    const galleryTitle = main.querySelector('#gn, #gj');
    if(galleryTitle){
      const titleEl = document.createElement('h1'); titleEl.className = 'ehx-gallery-title';
      titleEl.textContent = galleryTitle.textContent.trim();
      grid.parentNode.insertBefore(titleEl, grid);
    }
  }

  function applyGridStyles(gridElement){
    const cols = clampInt(st.gridCols, 2, 12);
    const rows = clampInt(st.gridRows, 0, 12);
    gridElement.style.gridTemplateColumns = `repeat(${cols}, minmax(0, 1fr))`;
    if(rows > 0){
      gridElement.style.maxHeight = `${rows * 260}px`;
      gridElement.style.overflow = 'auto';
    } else {
      gridElement.style.maxHeight = '';
      gridElement.style.overflow = '';
    }
  }

  // ---------- æ¢å¤æœç´¢UI ----------
  function restoreSearchUI(main){
    if (window.location.pathname === '/' || window.location.pathname === '/watched') {
      return;
    }
    try{
      // æ‰¾åˆ°åŸå§‹è¡¨å•
      let origForm = document.querySelector('form[action*="search"], form[name*="f_search"], form#searchform');
      if(!origForm) origForm = document.querySelector('input[name="f_search"], input[type="search"]')?.closest('form');

      // æ£€æŸ¥æ˜¯å¦å·²æœ‰å¯è§çš„æœç´¢è¡¨å•
      const existingVisible = main.querySelector('form[action*="search"], #searchform, .gsearch, .srch, #taglist');
      if(existingVisible && isVisible(existingVisible)) return;

      if(!origForm) return;

      // å…‹éš†å¹¶æ’å…¥åˆ°mainé¡¶éƒ¨
      const clone = origForm.cloneNode(true);
      clone.id = 'ehx-cloned-searchform';
      clone.style.display = 'block';
      clone.style.opacity = '1';
      clone.style.visibility = 'visible';

      const containerId = 'ehx-searchbar-container';
      if(!document.getElementById(containerId)){
        const container = document.createElement('div'); container.id = containerId;
        container.style.marginBottom = '12px'; container.className = 'ehx-card';
        // æ’å…¥åˆ°é¡¶éƒ¨
        main.insertBefore(container, main.firstChild);
        container.appendChild(clone);
        // å¼ºåˆ¶æ˜¾ç¤ºå¯èƒ½è¢«éšè—çš„å…ƒç´ 
        clone.querySelectorAll('select, label, .taglist, .gsearch, .srch, .searchbox').forEach(el=>{
          el.style.display = 'inline-block'; el.style.visibility='visible'; el.style.opacity='1';
        });
      }
    }catch(e){
      console.warn('EHX restoreSearchUI error', e);
    }
  }

  // ---------- é˜…è¯»æ¨¡å¼å¢å¼ºåŠŸèƒ½ ----------
  function initReaderEnhancements() {
    // è‡ªåŠ¨è®¾ç½®ä¸ºVerticalæ¨¡å¼ï¼ˆå¦‚æœå°šæœªè®¾ç½®ï¼‰
    if (document.querySelector('#d') === null) {
      let vertBtn = document.querySelector('a[href*="&nw=vert"]');
      if (vertBtn) {
        // æ£€æŸ¥URLä¸­æ˜¯å¦å·²æœ‰å‚ç›´æ¨¡å¼å‚æ•°
        if (!window.location.href.includes('&nw=vert')) {
          vertBtn.click();
          return; // ç­‰å¾…é¡µé¢é‡æ–°åŠ è½½
        }
      }
    }

    const container = document.querySelector('#i3');
    if (!container) return;

    let loading = false;

    // æ— é™æ»šåŠ¨
    window.addEventListener('scroll', async () => {
      // æ°´å¹³æ¨¡å¼ä¸‹ä¸å¯ç”¨æ— é™æ»šåŠ¨
      if (st.readingMode === 'horizontal') return;
      if (loading) return;
      // æ¥è¿‘é¡µé¢åº•éƒ¨æ—¶åŠ è½½ä¸‹ä¸€é¡µ
      if (window.innerHeight + window.scrollY >= document.body.scrollHeight - 200) {
        loading = true;
        let nextLink = document.querySelector('#ib a[onclick]');
        if (nextLink) {
          try {
            const nextUrl = nextLink.href;
            let resp = await fetch(nextUrl);
            let html = await resp.text();
            let doc = new DOMParser().parseFromString(html, 'text/html');
            let nextImg = doc.querySelector('#i3 img');
            if (nextImg) {
              let newDiv = document.createElement('div');
              newDiv.style.marginTop = "20px";
              newDiv.appendChild(nextImg);
              container.appendChild(newDiv);
              // åº”ç”¨å›¾ç‰‡è‡ªé€‚åº”è®¾ç½®
              applyImageFit();
            }
            // æ›´æ–°URLä½†ä¸åˆ·æ–°é¡µé¢
            history.replaceState(null, "", nextUrl);
          } catch (e) {
            console.error('Failed to load next page:', e);
          } finally {
            loading = false;
          }
        } else {
          loading = false;
        }
      }
    });

    // é”®ç›˜å¿«æ·é”®
    document.addEventListener('keydown', e => {
      // é¿å…åœ¨è¾“å…¥æ¡†ä¸­è§¦å‘å¿«æ·é”®
      if (['INPUT', 'TEXTAREA', 'SELECT'].includes(e.target.tagName)) return;

      switch(e.key) {
        case 'ArrowRight':
          window.scrollBy(0, st.readingMode === 'horizontal' ? window.innerWidth : window.innerHeight);
          break;
        case 'ArrowLeft':
          window.scrollBy(0, st.readingMode === 'horizontal' ? -window.innerWidth : -window.innerHeight);
          break;
        case 'w': case 'W': window.scrollBy(0, -100); break;
        case 's': case 'S': window.scrollBy(0, 100); break;
      }
    });

    // å›¾ç‰‡ç‚¹å‡»å…¨å±
    container.addEventListener('click', e => {
      if (e.target.tagName === 'IMG') {
        if (!document.fullscreenElement) {
          e.target.requestFullscreen().catch(err => {
            console.error(`Error attempting to enable full-screen mode: ${err.message}`);
          });
        } else {
          if (document.exitFullscreen) {
            document.exitFullscreen();
          }
        }
      }
    });
  }

  // ---------- å¯åŠ¨ ----------
  function start(){
    if(document.readyState === 'loading') document.addEventListener('DOMContentLoaded', wrapSite);
    else wrapSite();
  }
  start();

  // ---------- èœå•é‡ç½® ----------
  GM_registerMenuCommand('Reset EHX UI Settings', ()=>{
    ['imgFit','gridCols','gridRows','lang','fontSize','sidebarCollapsed', 'readingMode', GRID_CUSTOM_FLAG].forEach(k => GMset('ehx_'+k, undefined));
    GMset(GRID_CUSTOM_FLAG, undefined);
    // è‡ªå®šä¹‰æ¶ˆæ¯æ¡†
    const msgBox = document.createElement('div');
    msgBox.style.cssText = `
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        padding: 20px;
        border: 1px solid #ccc;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        z-index: 10000;
        text-align: center;
    `;
    msgBox.innerHTML = `
        <p>å·²é‡ç½®ã€‚åˆ·æ–°é¡µé¢ç”Ÿæ•ˆã€‚</p>
        <button onclick="this.parentNode.remove()">ç¡®å®š</button>
    `;
    document.body.appendChild(msgBox);
  });

})();
